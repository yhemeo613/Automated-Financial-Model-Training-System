# 金融预测模型全面升级计划

根据您的专业要求，我制定了以下实施方案，将从底层数学逻辑到上层系统架构进行重构。

## Phase 1: 核心模型层升级 (Model Layer)
### 1. 多模型集成框架 (Ensemble Learning)
- **目标**: 实现 `EnsembleModel`，加权融合 LSTM (深度学习)、Random Forest (机器学习) 和 Linear Regression (统计基准)。
- **数学原理**: 通过 $ \hat{y} = \sum w_i f_i(x) $ 降低单一模型的方差 (Variance)。
- **不确定性量化**: 利用集成模型的预测方差或 LSTM 的 MC Dropout 计算 90% 置信区间 ($ \mu \pm 1.645\sigma $)。

### 2. 深度学习模型增强 (LSTM+)
- **正则化**: 在优化器中引入 L2 正则化 (`weight_decay`) 防止过拟合。
- **动态特征**: 支持 Dropout 层，用于训练时的正则化和预测时的贝叶斯近似。

## Phase 2: 训练与验证逻辑重构 (Training Pipeline)
### 1. 严格的交叉验证 (Cross-Validation)
- **方法**: 摒弃随机 K-Fold，采用 **TimeSeriesSplit** (滚动时间窗交叉验证)，防止未来信息泄露 (Look-ahead Bias)。
- **流程**: 训练集/验证集随时间轴滚动，计算平均 Metrics。

### 2. 数据漂移检测 (Data Drift Detection)
- **统计检验**: 在预测前，对当前窗口数据与训练数据进行 **Kolmogorov-Smirnov (KS) Test**。
- **阈值控制**: 若 p-value < 0.05 或统计量超标，触发漂移告警。

### 3. 网格搜索 (Grid Search)
- **自动调优**: 针对 LSTM (hidden_size, layers) 和 RF (n_estimators) 进行超参数搜索。

## Phase 3: 预测与解释性模块 (Prediction & Explainability)
### 1. 结果增强
- **置信区间**: 输出预测的上界 (Upper Bound) 和下界 (Lower Bound)。
- **特征重要性**: 对于 RF 模型输出 Feature Importance；对于 LSTM 使用 Permutation Importance (简化版)。

## Phase 4: 前端可视化升级 (Visualization)
- **图表**: `ChartPanel` 支持显示置信区间 (区域图)。
- **监控**: `ResultsPanel` 增加数据漂移状态、特征贡献度图表。

---

**实施顺序**:
1.  重构模型类 (LSTM增强, 新增Ensemble)。
2.  重构 Service 层训练逻辑 (交叉验证, 网格搜索)。
3.  重构 Service 层预测逻辑 (置信区间, 漂移检测)。
4.  升级前端界面展示。